<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visconti Ailesi | Ba≈üvuru</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="index-page">

    <div style="text-align:center; padding-top:40px;">
        <img src="Visconti.jpg" width="150" style="border-radius:50%; border:2px solid #cfb53b; box-shadow:0 0 20px rgba(207,181,59,0.3);">
        <h1 style="color:#cfb53b; font-family:'Cinzel', serif; margin-top:20px;">VISCONTI Aƒ∞LESƒ∞</h1>
        <p style="color:#666;">"G√º√ß, Sadakat, Onur"</p>
    </div>

    <a href="admin.html" style="position:absolute; top:20px; right:20px; color:#333; font-size:1.2rem;"><i class="fas fa-key"></i></a>

    <div class="container">
        <section>
            <h2>Resmi Ba≈üvuru Formu</h2>
            <form id="viscontiForm">
                <div style="display:flex; gap:15px; margin-bottom:20px;">
                    <input type="text" id="discord_id" class="input-dark" placeholder="Discord ID (√∂rn: kullanici#1234)" required>
                    <input type="text" id="ic_name" class="input-dark" placeholder="IC ƒ∞sim Soyisim" required>
                    <input type="number" id="ic_age" class="input-dark" placeholder="Ya≈ü" style="width:80px;" required>
                </div>

                <div style="background:#000; padding:15px; border-radius:6px; max-height:400px; overflow-y:auto; border:1px solid #333; margin-bottom:20px;">
                    <p style="color:#cfb53b; margin-bottom:10px;">A≈üaƒüƒ±daki sorularƒ± detaylƒ±ca cevaplayƒ±nƒ±z:</p>
                    
                    <div style="margin-bottom:15px;">
                        <label style="font-size:0.9rem; color:#aaa;">1. Kendinizi ve karakterinizin hikayesini anlatƒ±n.</label>
                        <textarea id="q1" class="input-dark" rows="3" required></textarea>
                    </div>
                    <div style="margin-bottom:15px;">
                        <label style="font-size:0.9rem; color:#aaa;">2. Powergaming ve Metagaming nedir? √ñrnek verin.</label>
                        <textarea id="q2" class="input-dark" rows="2" required></textarea>
                    </div>
                    <div style="margin-bottom:15px;">
                        <label style="font-size:0.9rem; color:#aaa;">3. Bir aile √ºyesi ihanet ederse tepkiniz ne olur?</label>
                        <textarea id="q3" class="input-dark" rows="2" required></textarea>
                    </div>
                    <div style="margin-bottom:15px;">
                        <label style="font-size:0.9rem; color:#aaa;">4. Aile hiyerar≈üisine bakƒ±≈ü a√ßƒ±nƒ±z nedir?</label>
                        <textarea id="q4" class="input-dark" rows="2" required></textarea>
                    </div>
                    <div style="margin-bottom:15px;">
                        <label style="font-size:0.9rem; color:#aaa;">5. G√ºnl√ºk aktiflik s√ºreniz nedir?</label>
                        <input type="text" id="q5" class="input-dark" required>
                    </div>
                </div>

                <button type="submit" id="btnSubmit" class="btn-action btn-gold" style="width:100%; padding:15px; font-size:1.1rem;">BA≈ûVURUYU G√ñNDER</button>
            </form>
        </section>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCdoh5yMYMpnmddGpCzXyQtDhSnXo8cLHg",
            authDomain: "veltora.firebaseapp.com",
            databaseURL: "https://veltora-default-rtdb.firebaseio.com",
            projectId: "veltora",
            storageBucket: "veltora.firebasestorage.app",
            messagingSenderId: "62609466462",
            appId: "1:62609466462:web:5813c33c88df4f212600cf",
            measurementId: "G-PQBJN0MLXR"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const WEBHOOK_URL = "https://discord.com/api/webhooks/1465195587577057454/Kk3hwNtZ8STa8NqOMcyk34E3Qig9ZU2Mf4stZ2eqZdzWvv5sibDw1tSuwWVsWM7qGaoT";

        document.getElementById('viscontiForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnSubmit');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒ∞≈üleniyor...';
            btn.disabled = true;

            const form = {
                discord: document.getElementById('discord_id').value,
                name: document.getElementById('ic_name').value,
                age: document.getElementById('ic_age').value,
                q1: document.getElementById('q1').value,
                q2: document.getElementById('q2').value,
                q3: document.getElementById('q3').value,
                q4: document.getElementById('q4').value,
                q5: document.getElementById('q5').value
            };

            const fullStory = `**Hikaye:** ${form.q1}\n**PG/MG:** ${form.q2}\n**ƒ∞hanet:** ${form.q3}\n**Hiyerar≈üi:** ${form.q4}\n**Aktiflik:** ${form.q5}`;

            try {
                // 1. Firebase Kayƒ±t
                await addDoc(collection(db, "basvurular"), {
                    discord: form.discord, icName: form.name, icAge: form.age, 
                    story: fullStory, tarih: serverTimestamp(), durum: "Beklemede", rank: ""
                });

                // 2. Discord Bildirim
                await fetch(WEBHOOK_URL, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        username: "Visconti Ba≈üvuru Botu",
                        avatar_url: "https://raw.githubusercontent.com/baron/visconti/main/Visconti.jpg",
                        content: `üì¢ **YENƒ∞ BA≈ûVURU!** <@&1464989769762078934> yetkilileri panele bekleniyor.`,
                        embeds: [{
                            title: "üìù Ba≈üvuru Detaylarƒ±",
                            color: 16776960, // Sarƒ±
                            fields: [
                                { name: "Ki≈üi", value: form.name, inline: true },
                                { name: "Discord", value: form.discord, inline: true },
                                { name: "Ya≈ü", value: form.age, inline: true }
                            ],
                            description: "Ba≈üvuru i√ßeriƒüi y√∂netim panelinden okunabilir.",
                            timestamp: new Date().toISOString()
                        }]
                    })
                });

                alert("Ba≈üvurunuz ba≈üarƒ±yla iletildi.");
                location.reload();
            } catch (err) {
                console.error(err);
                alert("Hata olu≈ütu: " + err.message);
                btn.disabled = false;
                btn.innerText = "TEKRAR DENE";
            }
        });
    </script>
</body>
</html>
